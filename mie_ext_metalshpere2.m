 clear all, clc, close all 

%GOLD%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%(From Babar and Weaver 2015)
%Imaginary part of the refractive index
k1_Au=[0.2066,1.98591656445;0.21089508319,1.97534779229;0.215279458439,1.96597777856;0.219754982075,1.95853718525;0.224323549012,1.95347479861;0.228987093564,1.95092054945;0.233747590255,1.95067979422;0.238607054657,1.9522622682;0.243567544248,1.95494272809;0.248631159276,1.95784420876;0.253800043655,1.96003112281;0.259076385867,1.96059922867;0.264462419893,1.95875241037;0.269960426156,1.95386083963;0.275572732488,1.94549986044;0.281301715116,1.93347278078;0.287149799665,1.91782321271;0.293119462189,1.89884348931;0.299213230217,1.87708470227;0.305433683824,1.8533704822;0.311783456723,1.82881024922;0.318265237381,1.80479849309;0.324881770154,1.78297652266;0.331635856454,1.76512629255;0.338530355932,1.75296935729;0.345568187689,1.74786631426;0.352752331512,1.7504582283;0.360085829136,1.76035121563;0.367571785533,1.77598261657;0.375213370223,1.79477454227;0.383013818621,1.8135693006;0.390976433402,1.82921617912;0.399104585903,1.83912927233;0.407401717548,1.84168456543;0.415871341306,1.83641651484;0.42451704318,1.82404632603;0.433342483722,1.80640361052;0.442351399584,1.78630032214;0.451547605104,1.76739565371;0.460934993913,1.75405729533;0.470517540592,1.75117198333;0.480299302349,1.76378471582;0.49028442074,1.79639799686;0.50047712342,1.85189192283;0.510881725935,1.93046771509;0.521502633549,2.02941584261;0.532344343107,2.14408290908;0.543411444943,2.26939106271;0.554708624818,2.40097284195;0.56624066591,2.53559991916;0.578012450835,2.67112775467;0.590028963715,2.80625688674;0.602295292289,2.94028330861;0.614816630068,3.07289808958;0.627598278532,3.204042941;0.640645649374,3.33381143007;0.653964266795,3.46238342848;0.667559769839,3.58998261813;0.681437914784,3.71684963608;0.695604577575,3.84322568932;0.710065756315,3.96934309571;0.724827573806,4.09542033789;0.739896280135,4.22165999327;0.755278255329,4.34824843716;0.770980012047,4.47535658348;0.787008198346,4.60314118084;0.803369600489,4.73174635512;0.820071145824,4.86130520764;0.837119905712,4.99194135685;0.854523098523,5.12377036316;0.872288092693,5.25690100961;0.890422409845,5.39143643137;0.908933727968,5.52747509882;0.927829884674,5.66511166545;0.947118880514,5.80443769435;0.966808882365,5.94554227814;0.986908226887,6.08851256644;1.00742542406,6.23343421379;1.02836916076,6.38039175994;1.0497483045,6.52946895243;1.07157190709,6.68074902054;1.09384920857,6.8343149079;1.11658964103,6.99024947049;1.13980283269,7.14863564526;1.16349861191,7.30955659417;1.18768701137,7.47309582753;1.21237827235,7.63933730999;1.237582849,7.80836555206;1.26331141285,7.98026568947;1.28957485725,8.15512355256;1.31638430203,8.33302572727;1.34375109819,8.51405960937;1.37168683271,8.69831345306;1.40020333347,8.88587641506;1.42931267422,9.07683859508;1.45902717974,9.27129107334;1.48935943101,9.46932594594;1.52032227059,9.67103635839;1.55192880799,9.87651653797;1.58419242529,10.085861825;1.61712678277,10.2991687034;1.65074582469,10.5165348313;1.6850637852,10.7380590705;1.72009519439,10.9638415166;1.75585488439,11.1939835286;1.7923579957,11.4285877588;1.82961998359,11.6677581822;1.86765662461,11.9116001269;1.90648402331,12.1602203034;1.94611861905,12.4137268346;1.98657719294,12.6722292853;2.02787687497,12.9358386922;2.07003515123,13.2046675927;2.11306987137,13.4788300544;2.15699925609,13.7584417033;2.2018419049,14.0436197522;2.24761680399,14.3344830281;2.29434333425,14.6311519989;2.34204127949,14.9337487993;2.39073083481,15.242397256;2.44043261516,15.557222911;2.49116766405,15.8783530446;2.54295746248,16.205916696;2.59582393804,16.5400446837;2.64978947414,16.8808696226;2.70487691958,17.2285259404;2.76110959812,17.5831498916;2.81851131845,17.9448795695;2.8771063842,18.3138549153;2.93691960427,18.6902177253;2.99797630331,19.0741116548;3.06030233246,19.4656822198;3.1239240803,19.8650767947;3.188868484,20.2724446074;3.25516304072,20.6879367303;3.32283581931,21.1117060677;3.39191547211,21.5439073394;3.46243124716,21.9846970594;3.53441300053,22.4342335112;3.60789120897,22.8926767167;3.68289698284,23.3601884018;3.75946207926,23.8369319549;3.83761891556,24.3230723814;3.91740058299,24.818776251;3.99884086078,25.3242116392;4.08197423038,25.8395480625;4.1668358901,26.3649564062;4.25346176999,26.9006088451;4.34188854708,27.4466787567;4.43215366088,28.0033406265;4.52429532923,28.5707699445;4.61835256454,29.1491430937;4.71436519021,29.738637229;4.81237385758,30.3394301469;4.91242006309,30.9517001453;5.01454616587,31.5756258729;5.11879540566,32.2113861689;5.22521192114,32.8591598904;5.3338407686,33.5191257296;5.44472794102,34.191462019;5.55792038754,34.8763465244;5.67346603336,35.5739562259;5.79141379999,36.2844670861;5.91181362602,37.0080538055;6.0347164882,37.7448895647;6.16017442306,38.4951457535;6.28824054896,39.2589916857;6.41896908852,40.0365943015;6.55241539166,40.8281178548;6.68863595894,41.633723588;6.82768846557,42.4535693921;6.96963178576,43.2878094535;7.11452601772,44.1365938879;7.26243250901,45.0000683603;7.41341388261,45.8783736927;7.56753406337,46.7716454592;7.72485830511,47.6800135698;7.88545321822,48.6036018426;8.04938679789,49.5425275664;8.21672845289,50.4969010538;8.38754903495,51.4668251858;8.56192086874,52.4523949503;8.73991778256,53.4536969744;8.92161513952,54.4708090531;9.10708986948,55.5037996756;9.29642050165,56.5527275519;9.48968719778,57.6176411403;9.68697178616,58.6985781795;9.88835779621,59.7955652274;10.0939304939,60.9086172084;10.3037769178,62.0377369732;10.517985916,63.1829148725;10.7366481837,64.3441283502;10.9598563014,65.5213415561;11.1877047746,66.7145049842;11.4202900733,67.923555139;11.6577106731,69.1484142333;11.9000670968,70.388989921;12.1474619572,71.6451750702;12.4,72.9168475779];
%Real part of the refractive index
n1_Au=[0.2066,1.25223320824;0.21089508319,1.28860501667;0.215279458439,1.32053986347;0.219754982075,1.34888336249;0.224323549012,1.3746284289;0.228987093564,1.39882611415;0.233747590255,1.42248550103;0.238607054657,1.44647562039;0.243567544248,1.47144312879;0.248631159276,1.49775668894;0.253800043655,1.52548341112;0.259076385867,1.55439629116;0.264462419893,1.58400639322;0.269960426156,1.6136108117;0.275572732488,1.64234733089;0.281301715116,1.66924858331;0.287149799665,1.69329166131;0.293119462189,1.71344305996;0.299213230217,1.72870316606;0.305433683824,1.73815864557;0.311783456723,1.74105369497;0.318265237381,1.73689001004;0.324881770154,1.72555779493;0.331635856454,1.70748407952;0.338530355932,1.68376050988;0.345568187689,1.65618696109;0.352752331512,1.62715563874;0.360085829136,1.5993263363;0.367571785533,1.57512081975;0.375213370223,1.55616625486;0.383013818621,1.5428732988;0.390976433402,1.53428802988;0.399104585903,1.5282356392;0.407401717548,1.52166602777;0.415871341306,1.51107621084;0.42451704318,1.49291226063;0.433342483722,1.46390381788;0.442351399584,1.42132874128;0.451547605104,1.36323722341;0.460934993913,1.28868530644;0.470517540592,1.19803128159;0.480299302349,1.0933056197;0.49028442074,0.97852316585;0.50047712342,0.859575063526;0.510881725935,0.743288882063;0.521502633549,0.635790656008;0.532344343107,0.541093350059;0.543411444943,0.460739155424;0.554708624818,0.394373918234;0.56624066591,0.340593024822;0.578012450835,0.297605602816;0.590028963715,0.263621057179;0.602295292289,0.237028009053;0.614816630068,0.21645383529;0.627598278532,0.200765474753;0.640645649374,0.189045341648;0.653964266795,0.180559280841;0.667559769839,0.174724390804;0.681437914784,0.171079979374;0.695604577575,0.169262728402;0.710065756315,0.168986132123;0.724827573806,0.170023837191;0.739896280135,0.172196353782;0.755278255329,0.175360582261;0.770980012047,0.179401637013;0.787008198346,0.184226512035;0.803369600489,0.189759203016;0.820071145824,0.195936968685;0.837119905712,0.202707475388;0.854523098523,0.2100266216;0.872288092693,0.217856882985;0.890422409845,0.22616605438;0.908933727968,0.234926293578;0.927829884674,0.244113394196;0.947118880514,0.253706232338;0.966808882365,0.263686345098;0.986908226887,0.274037609153;1.00742542406,0.284745995453;1.02836916076,0.295799381814;1.0497483045,0.307187409657;1.07157190709,0.318901374431;1.09384920857,0.330934141782;1.11658964103,0.343280083388;1.13980283269,0.355935027838;1.16349861191,0.368896223022;1.18768701137,0.382162307315;1.21237827235,0.395733287491;1.237582849,0.409610521811;1.26331141285,0.42379670708;1.28957485725,0.438295868801;1.31638430203,0.453113353762;1.34375109819,0.468255824603;1.37168683271,0.48373125601;1.40020333347,0.499548932349;1.42931267422,0.515719446594;1.45902717974,0.532254700497;1.48935943101,0.549167905985;1.52032227059,0.566473587824;1.55192880799,0.584187587597;1.58419242529,0.60232706909;1.61712678277,0.620910525167;1.65074582469,0.639957786243;1.6850637852,0.659490030471;1.72009519439,0.679529795737;1.75585488439,0.700100993588;1.7923579957,0.721228925198;1.82961998359,0.742940299461;1.86765662461,0.765263253341;1.90648402331,0.788227374534;1.94611861905,0.81186372657;1.98657719294,0.836204876404;2.02787687497,0.861284924597;2.07003515123,0.887139538148;2.11306987137,0.913805986037;2.15699925609,0.941323177553;2.2018419049,0.969731703453;2.24761680399,0.999073880003;2.29434333425,1.02939379595;2.34204127949,1.06073736249;2.39073083481,1.09315236616;2.44043261516,1.12668852494;2.49116766405,1.16139754724;2.54295746248,1.19733319414;2.59582393804,1.23455134469;2.64978947414,1.27311006436;2.70487691958,1.31306967671;2.76110959812,1.3544928382;2.81851131845,1.3974446162;2.8771063842,1.44199257024;2.93691960427,1.48820683645;2.99797630331,1.53616021518;3.06030233246,1.58592826192;3.1239240803,1.63758938132;3.188868484,1.69122492445;3.25516304072,1.7469192892;3.32283581931,1.80476002384;3.39191547211,1.86483793364;3.46243124716,1.92724719063;3.53441300053,1.99208544622;3.60789120897,2.05945394691;3.68289698284,2.12945765279;3.75946207926,2.20220535878;3.83761891556,2.27780981863;3.91740058299,2.35638787144;3.99884086078,2.43806057054;4.08197423038,2.52295331476;4.1668358901,2.6111959817;4.25346176999,2.70292306299;4.34188854708,2.79827380114;4.43215366088,2.89739232795;4.52429532923,3.00042780404;4.61835256454,3.10753455933;4.71436519021,3.218872234;4.81237385758,3.33460591977;4.91242006309,3.45490630092;5.01454616587,3.57994979477;5.11879540566,3.70991869101;5.22521192114,3.84500128958;5.3338407686,3.98539203627;5.44472794102,4.13129165578;5.55792038754,4.28290728129;5.67346603336,4.44045258009;5.79141379999,4.60414787441;5.91181362602,4.77422025668;6.0347164882,4.95090369846;6.16017442306,5.13443915202;6.28824054896,5.32507464379;6.41896908852,5.52306535848;6.55241539166,5.72867371303;6.68863595894,5.94216941914;6.82768846557,6.16382953324;6.96963178576,6.39393849275;7.11452601772,6.63278813733;7.26243250901,6.88067771379;7.41341388261,7.1379138633;7.56753406337,7.40481058966;7.72485830511,7.68168920691;7.88545321822,7.96887826518;8.04938679789,8.26671345301;8.21672845289,8.57553747479;8.38754903495,8.8956999019;8.56192086874,9.22755699586;8.73991778256,9.57147150229;8.92161513952,9.927812414;9.10708986948,10.296954702;9.29642050165,10.6792790132;9.48968719778,11.0751713331;9.68697178616,11.4850226129;9.88835779621,11.9092283598;10.0939304939,12.3481881894;10.3037769178,12.8023053398;10.517985916,13.2719861468;10.7366481837,13.7576394791;10.9598563014,14.2596761352;11.1877047746,14.7785082;11.4202900733,15.3145483628;11.6577106731,15.8682091977;11.9000670968,16.4399024059;12.1474619572,17.0300380225;12.4,17.6390235898];

%SILVER%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%(From Babar and Weaver 2015)
%Imaginary Part of the refractive index
k1_Ag=[0.2066,1.247;0.2101,1.258;0.2138,1.267;0.2175,1.272;0.2214,1.28;0.2254,1.283;0.2296,1.287;0.2339,1.294;0.2384,1.306;0.2431,1.317;0.248,1.326;0.253,1.328;0.2583,1.327;0.2638,1.329;0.2695,1.31;0.2755,1.291;0.2818,1.247;0.2883,1.181;0.2952,1.079;0.3024,0.894;0.31,0.656;0.3179,0.466;0.3263,0.651;0.3351,1.042;0.3444,1.269;0.3542,1.467;0.3647,1.645;0.3757,1.815;0.3875,1.981;0.3999,2.138;0.4133,2.292;0.4275,2.448;0.4428,2.604;0.4592,2.765;0.4769,2.93;0.4959,3.105;0.5166,3.288;0.5391,3.483;0.5636,3.694;0.5904,3.918;0.6199,4.164;0.6525,4.432;0.6888,4.725;0.7293,5.048;0.7749,5.409;0.8266,5.814;0.8856,6.276;0.9537,6.802;1.033,7.412;1.127,8.128;1.24,8.981;1.305,9.472;1.378,10.018;1.459,10.63;1.55,11.31;1.653,12.08;1.771,12.97;1.907,13.98;2.066,15.16;2.254,16.56;2.48,18.23;2.755,20.26;3.1,22.8;3.542,26.05;4.133,30.37;4.959,36.37;6.199,45.26;8.266,59.73;12.4,86.53];
%Real Part of the refractive index
n1_Ag=[0.2066,1.079;0.2101,1.101;0.2138,1.121;0.2175,1.14;0.2214,1.157;0.2254,1.169;0.2296,1.181;0.2339,1.19;0.2384,1.198;0.2431,1.215;0.248,1.233;0.253,1.254;0.2583,1.27;0.2638,1.294;0.2695,1.321;0.2755,1.348;0.2818,1.38;0.2883,1.402;0.2952,1.427;0.3024,1.41;0.31,1.265;0.3179,0.859;0.3263,0.307;0.3351,0.187;0.3444,0.142;0.3542,0.106;0.3647,0.076;0.3757,0.061;0.3875,0.05;0.3999,0.054;0.4133,0.05;0.4275,0.051;0.4428,0.052;0.4592,0.052;0.4769,0.053;0.4959,0.052;0.5166,0.052;0.5391,0.05168;0.5636,0.05009;0.5904,0.04977;0.6199,0.04803;0.6525,0.04964;0.6888,0.0508;0.7293,0.05151;0.7749,0.05269;0.8266,0.05504;0.8856,0.05896;0.9537,0.06542;1.033,0.07286;1.127,0.08427;1.24,0.09799;1.305,0.1056;1.378,0.1143;1.459,0.1256;1.55,0.1388;1.653,0.1543;1.771,0.1735;1.907,0.1988;2.066,0.2315;2.254,0.2724;2.48,0.3256;2.755,0.397;3.1,0.496;3.542,0.6387;4.133,0.8566;4.959,1.228;6.199,1.851;8.266,3.227;12.4,5.079];

%SILICON%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%(From Aspnes and Studna 1983)(only goes up to 800nm needs to go to 1000nm)
%Imaginary part of the refractive index
k1_Si=[0.2066,2.909;0.2101,2.982;0.2138,3.045;0.2175,3.120;0.2214,3.206;0.2254,3.302;0.2296,3.366;0.2339,3.353;0.2384,3.354;0.2431,3.429;0.2480,3.565;0.2530,3.749;0.2583,3.979;0.2638,4.278;0.2695,4.678;0.2755,5.082;0.2818,5.344;0.2883,5.395;0.2952,4.639;0.3024,3.979;0.3100,3.586;0.3179,3.346;0.3263,3.182;0.3351,3.058;0.3444,2.987;0.3542,3.014;0.3647,2.705;0.3757,1.320;0.3875,0.630;0.3999,0.387;0.4133,0.269;0.4275,0.203;0.4428,0.163;0.4592,0.130;0.4769,0.090;0.4959,0.073;0.5166,0.060;0.5391,0.048;0.5636,0.032;0.5904,0.030;0.6199,0.022;0.6525,0.016;0.6888,0.013;0.7293,0.010;0.7749,0.008;0.8266,0.005];
%Real part of the refractive index
n1_Si=[0.2066,1.010;0.2101,1.083;0.2138,1.133;0.2175,1.186;0.2214,1.247;0.2254,1.340;0.2296,1.471;0.2339,1.579;0.2384,1.589;0.2431,1.571;0.2480,1.570;0.2530,1.597;0.2583,1.658;0.2638,1.764;0.2695,1.988;0.2755,2.452;0.2818,3.120;0.2883,4.087;0.2952,4.888;0.3024,5.020;0.3100,5.010;0.3179,5.016;0.3263,5.065;0.3351,5.156;0.3444,5.296;0.3542,5.610;0.3647,6.522;0.3757,6.709;0.3875,6.062;0.3999,5.570;0.4133,5.222;0.4275,4.961;0.4428,4.753;0.4592,4.583;0.4769,4.442;0.4959,4.320;0.5166,4.215;0.5391,4.123;0.5636,4.042;0.5904,3.969;0.6199,3.906;0.6525,3.847;0.6888,3.796;0.7293,3.752;0.7749,3.714;0.8266,3.673];

%Plots the refractive index functions for silicon, showing a plateo at the
%upper boundary, from this we can determine that using wavlengths at 1000nm would be accuarate even though function finishes at 800nm.
% plot(k1_Si(:,1),k1_Si(:,2))
% title('Refractice index of Silicon')
% xlabel('Wavelength (nm)')
% ylabel('Refractive index (n,k)')
% hold on
% plot(k1_Si(:,1),n1_Si(:,2))
% legend('Imaginary Part of Refractive Index - "k"','Real Part of Refractive Index - "n"')





%SILICA%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%(From Malitson 1965)
%Real part of the refractive index (Note no imaginary part)
n1_Si02=[0.2100,1.5383576204905;0.2174,1.530846431063;0.2251,1.5240789072975;0.2330,1.5180417677275;0.2412,1.5125721155558;0.2497,1.5076095872199;0.2585,1.5031009629039;0.2676,1.498999218542;0.2770,1.495262719426;0.2868,1.4918215034661;0.2969,1.488683281387;0.3074,1.4857914366574;0.3182,1.4831504333467;0.3294,1.4807144415912;0.3410,1.4784676522483;0.3530,1.4763951298847;0.3655,1.4744682820342;0.3783,1.4727046797948;0.3917,1.4710525123802;0.4055,1.4695286500209;0.4197,1.4681218218832;0.4345,1.4668048202486;0.4498,1.465580829975;0.4657,1.4644360310913;0.4821,1.4633719346282;0.4991,1.4623764385944;0.5167,1.4614449911601;0.5349,1.4605730794883;0.5537,1.4597562854765;0.5732,1.4589865613939;0.5934,1.4582607881284;0.6143,1.4575758068817;0.6360,1.4569256013294;0.6584,1.4563104080175;0.6816,1.4557246986958;0.7056,1.4551660299221;0.7305,1.4546298754538;0.7562,1.4541161650842;0.7829,1.4536188536247;0.8104,1.4531396102638;0.8390,1.4526712743322;0.8686,1.4522138205731;0.8992,1.4517653834747;0.9308,1.4513240787777;0.9636,1.4508853971281;0.9976,1.450447735732;1.033,1.4500069615101;1.069,1.4495710901504;1.107,1.4491214616538;1.146,1.448668310738;1.186,1.4482096590065;1.228,1.4477322458328;1.271,1.4472455774929;1.316,1.4467363524093;1.362,1.4462138519129;1.410,1.445664578157;1.460,1.4450861470109;1.512,1.4444759883488;1.565,1.4438434020915;1.620,1.4431739285381;1.677,1.4424645759259;1.736,1.4417121733672;1.797,1.4409133669095;1.861,1.4400509385522;1.926,1.43914806608;1.994,1.4381729429417;2.064,1.4371349603433;2.137,1.4360139618555;2.212,1.4348196176837;2.290,1.433529881253;2.371,1.4321372109342;2.454,1.4306516985468;2.541,1.4290287283802;2.630,1.427296093753;2.723,1.4254044329951;2.819,1.4233613684394;2.918,1.4211544161909;3.021,1.4187459519934;3.128,1.416117293379;3.238,1.4132741569442;3.352,1.4101696832452;3.470,1.4067782146466;3.592,1.4030708962299;3.719,1.3989819997456;3.850,1.3945035722002;3.986,1.3895553417944;4.126,1.3841208059058;4.271,1.3780997735118;4.422,1.3713701305288;4.578,1.36388143366;4.739,1.3555262189157;4.906,1.3461171232165;5.079,1.3354823573874;5.258,1.3234105439689;5.443,1.3096384003386;5.635,1.2937460280032;5.833,1.2753723963511;6.039,1.2537289561387;6.252,1.2280888354422;6.472,1.1973256716307;6.700,1.1596494139777];

prompt = 'Choose Material(Au=1, Ag=2, Si=3, Si02=4):';
mat=input(prompt);

if mat<4
l=linspace(300e-9,1000e-9,500); %Defines row vector for wavelength (step size currently at 500)
else
l=linspace(400e-9,1500e-9,500);
end
lm=l*1e+9; % Defines wavelength in nanometers 
N=1; %Defines refractive index of the medium
                     
B=zeros(500,4); %Creates Matrix where wavelenght, C_ext, C_scat, C_abs 
                %can be stored in the coloumns respectivally. 

B(:,1)=rot90(l,-1); %Places wavelength data in first coloumn



prompt = 'Choose particle size in nanometres (reasonable vaues: 20-1000):';
rn=input(prompt);
r = rn*1e-9;   

w=l.*1e+6; %wavelength in mircrons as n1 and k1 are in microns. 


% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 
% interp refractive index value from Ralec optical handbook
if mat == 1
   N1_1=interp1(n1_Au(:,1),n1_Au(:,2),w)+1i*interp1(k1_Au(:,1),k1_Au(:,2),w);
end

if mat == 2
   N1_1=interp1(n1_Ag(:,1),n1_Ag(:,2),w)+1i*interp1(k1_Ag(:,1),k1_Ag(:,2),w); 
end    

if mat == 3
   N1_1=interp1(n1_Si(:,1),n1_Si(:,2),w,'linear','extrap')+1i*interp1(k1_Si(:,1),k1_Si(:,2),w,'linear','extrap');
end

if mat == 4
   N1_1=interp1(n1_Si02(:,1),n1_Si02(:,2),w,'linear','extrap'); %Note K=0
end


m=N1_1./N;
k=2*pi.*N./l;
x=2*pi*N.*r./l;

Nstop=(x+4*x.^(1/3)+2);
ns=mean(Nstop);

mx=m.*x;

C_ext=0;
C_sca=0;
 for u=1:round(ns)
    n=u;
        n12=u+1/2;


    psix=x.*sqrt(pi./(2.*x)).*besselj(n12,x);

    psimx=m.*x.*sqrt(pi./(2.*m.*x)).*besselj(n12,m.*x);
    xix=x.*sqrt(pi./(2.*x)).*besselh(n12,x);


    xiprime1=1/2*sqrt(pi/2)*sqrt(1./x).*(x.*besselh(n12-1,x)+besselh(n12,x)-x.*besselh(n12+1,x));
    psiprimex1=1/2*sqrt(pi/2)*sqrt(1./x).*(x.*besselj(n12-1,x)+besselj(n12,x)-x.*besselj(n12+1,x));
    psiprimemx1=1/2*sqrt(pi/2)*sqrt(1./mx).*(mx.*besselj(n12-1,mx)+besselj(n12,mx)-mx.*besselj(n12+1,mx));

% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %     
    aut=(m.*psimx.*psiprimex1-psix.*psiprimemx1);
    aub=(m.*psimx.*xiprime1-psiprimemx1.*xix);
    a1=aut./aub;
%      a coieffent
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 
     but=(psimx.*psiprimex1-m.*psix.*psiprimemx1);
     bub=(psimx.*xiprime1-m.*psiprimemx1.*xix);
     b1=but./bub;
%      b coeifient
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %  
   
      a=a1;
      b=b1;

    ab=(a+b);
    C_ext=(2*n+1)*(real(ab))+C_ext;
    C_sca=(2*n+1)*(abs(a).^2+abs(b).^2)+C_sca;
end

C_ext=C_ext*2*pi./(k.^2); 
% q_ext=1/(pi*(r)^2)*C_ext;

C_sca=2*pi./(k.^2).*C_sca;

C_abs =C_ext-C_sca;

B(:,2)=rot90(C_ext,-1);
B(:,3)=rot90(C_sca,-1);
B(:,4)=rot90(C_abs,-1);

[val1 ind1]=(max(C_ext)); %ind-position of max in array, Val-value of the max.
max_ext=lm(ind1);
[val2 ind2]=(max(C_sca));
max_scat=lm(ind2);
[val3 ind3]=(max(C_abs));
max_abs=lm(ind3);
D(N)=val1;
% % % % % % % % % % % % % % % % % % % % % % % % % % % % 

% figure(1)
% hold on
% plot(lm,C_ext,'r','LineWidth',2); xlabel('\lambda(nm)');ylabel('\sigma_e_x_t');title('Extinction Cross section of  Au nanospheres');
% % % % % % % % % % % % % % % % % % % % % % % % % % 
% figure(2)
% hold on
% plot(lm,C_sca,'k'); xlabel('\lambda(nm)');ylabel('\sigma_s_c_a');title('Scattering Cross section of Au nanospheres')
% % % % % % % % % % % % % % % % % % % % % % % % % % % 
% figure(3)
% hold on
% plot(lm,C_abs,'k'); xlabel('\lambda(nm)');ylabel('\sigma_a_b_s');title('Absorbance Cross section of Au nanospheres')

figure(1)
hold on
plot(lm,C_ext,'r','LineWidth',1.5); xlabel('\lambda(nm)');ylabel('Cross section (m^2)');title('Cross Sections of nanosphere');

hold on
plot(lm,C_sca,'--')

hold on
plot(lm,C_abs,'--')

legend('Extinction cross section','Scattering cross section','Absorption cross section')